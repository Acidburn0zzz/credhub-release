set -e -x

cd ${BUILD_DIR}

# Make sure we can see uname
export PATH=$PATH:/bin:/usr/bin

#unpack Java - we support Mac OS 64bit otherwise we require JAVA_HOME to point to JDK
if [ ! -d $JAVA_HOME ]; then
    echo "JAVA_HOME property set is required for non Linux/Darwin builds."
    exit 1
fi


#setup Java path
export PATH=$JAVA_HOME/bin:$PATH

#build credhub jar
cd ${BUILD_DIR}/credhub
    ./gradlew assemble
    #GIT_DIR=$(find $RELEASE_DIR -path "*/modules/src/credhub") ./gradlew :assemble
    cp credhub/build/libs/credhub*.jar ${BUILD_DIR}/credhub/credhub.jar

    #clean build data
    ./gradlew clean
