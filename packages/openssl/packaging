set -eux

tar -xvzf openssl_1.0.2/openssl-1.0.2j.tar.gz

export CPPFLAGS="-I/var/vcap/packages/zlib/include"
export LDFLAGS="-L/var/vcap/packages/zlib/lib"
export LIBRARY_PATH="/var/vcap/packages/zlib/lib"
export CFLAGS="-fPIC"

pushd openssl-1.0.2j
  ./config --prefix=${BOSH_INSTALL_TARGET} --openssldir=${BOSH_INSTALL_TARGET}/openssl shared zlib
  make
  make install
popd

rm -rf ${BOSH_INSTALL_TARGET}/openssl/bin
rm -rf ${BOSH_INSTALL_TARGET}/openssl/lib/*.a
rm -rf ${BOSH_INSTALL_TARGET}/openssl/include
rm -rf ${BOSH_INSTALL_TARGET}/openssl/openssl
